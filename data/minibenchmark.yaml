---
name: minibenchmark
description: a small benchmark
version: 0.01
gitlab: https://gitlab.renkulab.io/
orchestrator:
  name: mini_orchestrator
  url: omnibenchmark/mini/orchestrator
stages:
  0_data:
    initial: true
    members:
      - name: iris
        repo: omnibenchmark/mini/iris
      - name: cars
        repo: omnibenchmark/mini/cars
    outputs:
      - counts: data/{stage}/{name}/{reponame}/{name}.txt.gz
      - meta: data/{stage}/{name}/{reponame}/{name}.meta.json
      - data_specific_params: data/{stage}/{name}/{reponame}/{name}_params.txt
  1_preprocess:
    after: 0_data
    members:
      - name: log_transform
        repo: omnibenchmark/test/log
        parameters:
          - offset:
              - 1
              - 2
          - log_base:
              - 2
              - e
              - 10
        exclude:
          - cars
      - name: sqrt_transform
        repo: omnibenchmark/test/sqrt
    inputs:
      - counts: data/0_data/{name}/{reponame}/{name}.txt.gz
        meta: data/0_data/{name}/{reponame}/{name}.meta.json
    outputs:
      - filtered: output/{stage}/{name}/{reponame}/{params_and_identifiers}/{name}.txt.gz
  2_model:
    after: 1_preprocess
    members:
      - name: linear
        repo: omnibenchmark/test/lm
        parameters:
          - fast: false
      - name: glm
        repo: omnibenchmark/test/glm
    inputs:
      - counts: data/0_data/{name}/{reponame}/{name}.txt.gz
        meta: data/0_data/{name}/{reponame}/{name}.meta.json
        data_specific_params: data/{stage}/{name}/{reponame}/{name}_params.txt
      - filtered: output/1_preprocess/{name}/{reponame}/{params_and_identifiers}/{name}.txt.gz
        meta: data/0_data/{name}/{reponame}/{name}.meta.json
        data_specific_params: data/{stage}/{name}/{reponame}/{name}_params.txt
    outputs:
      - mapping: data/{stage}/{name}/{reponame}/{params_and_identifiers}/{name}.model.out.gz
  3_metrics:
    after: 2_model
    terminal: true
    members:
      - name: ari
        repo: omnibenchmark/test/ari
    inputs:
      - mapping: data/{stage}/{name}/{reponame}/{params_and_identifiers}/{name}.model.out.gz
        meta: data/0_data/{name}/{reponame}/{name}.meta.json
        data_specific_params: data/{stage}/{name}/{reponame}/{name}_params.txt
validator:
  name: test_validator
  url: omnibenchmark/test/test_validator
